<!doctype html>
<html lang="en">

<head>
  <title>Checkout | Galleria</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    body {
      background: #111;
      color: #fff;
    }

    .card {
      background: #1a1a1a;
      color: #fff;
    }

    input,
    textarea,
    select {
      background: #222;
      color: #fff;
      border: 1px solid #444;
    }

    input::placeholder,
    textarea::placeholder {
      color: #aaa;
    }

    button {
      background: #000;
      color: #fff;
      border: 1px solid #444;
    }

    h1,
    h2,
    h3,
    h4,
    h5,
    h6,
    p,
    label,
    span {
      color: #fff;
    }

    .error-msg {
      color: red;
      font-size: 12px;
      margin-top: 2px;
    }
  </style>
</head>

<body>
  <div class="container py-5">
    <h2 class="mb-4 text-center">Checkout</h2>

    <div class="row">
      <div class="col-lg-8">
        <div class="card p-4 mb-4">
          <h4 class="mb-3">Customer Details</h4>

          <div class="row g-3">
            <div class="col-md-6">
              <label>Full Name</label>
              <input type="text" class="form-control" id="Name" placeholder="Your Name" required>
            </div>

            <div class="col-md-6">
              <label>Email</label>
              <input type="email" class="form-control" id="Email" placeholder="Enter Email" required>
            </div>

            <div class="col-md-6">
              <label>Phone</label>
              <input type="text" class="form-control" id="Phone" placeholder="+92 300 0000000" required>
            </div>

            <div class="col-md-6">
              <label>City</label>
              <input type="text" class="form-control" id="City" placeholder="Karachi" required>
            </div>

            <div class="col-12">
              <label>Address</label>
              <textarea class="form-control" rows="3" id="Address" placeholder="Street, Area, House no"></textarea>
            </div>
          </div>
        </div>


        <div class="card p-4 mb-4">
          <h4>Ordered Products</h4>
          <div id="checkoutItems"></div>
        </div>
      </div>

      <div class="col-lg-4">
        <div class="card p-4">
          <h4>Order Summary</h4>
          <p>Total Items: <strong id="totalItems">0</strong></p>
          <h3>Rs.<span id="checkoutTotal">0</span></h3>

          <button id="placeOrder" class="btn btn-dark w-100 mt-3">
            Place Order
          </button>
        </div>
      </div>
    </div>
  </div>

  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script>
  $(document).ready(function () {

  var cart = JSON.parse(localStorage.getItem("cartitems")) || [];
  var total = 0;
  var itemsCount = 0;
  var discountRate = 0.30; // 30% discount

  if (cart.length === 0) {
    $("#checkoutItems").html("<p>Your cart is empty.</p>");
  } else {
    for (var i = 0; i < cart.length; i++) {
      var item = cart[i];
      var subtotal = item.price * item.qty;
      total += subtotal;
      itemsCount += item.qty;

      $("#checkoutItems").append(
        '<div style="display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid #444; padding:5px 0;">' +
        '<div style="display:flex; gap:10px;">' +
        '<img src="' + item.image + '" width="70">' +
        '<div>' +
        '<h6>' + item.name + '</h6>' +
        '<small>Rs.' + item.price.toLocaleString() + ' Ã— ' + item.qty + '</small>' +
        '</div>' +
        '</div>' +
        '<strong>Rs.' + subtotal.toLocaleString() + '</strong>' +
        '</div>'
      );
    }
  }

  // Apply 30% discount
  var discountedTotal = total - (total * discountRate);

  $("#checkoutTotal").text(discountedTotal.toLocaleString());
  $("#totalItems").text(itemsCount);

  // Place Order button
  $("#placeOrder").click(function () {
    $(".error-msg").remove();

    var name = $("#Name").val().trim();
    var email = $("#Email").val().trim();
    var phone = $("#Phone").val().trim();
    var city = $("#City").val().trim();
    var address = $("#Address").val().trim();

    var valid = true;
    var emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    var phoneRegex = /^[0-9\+]{7,15}$/;

    if (name === "") { addError("#Name", "Name is required"); valid = false; }
    if (email === "" || !emailRegex.test(email)) { addError("#Email", "Valid email is required"); valid = false; }
    if (phone === "" || !phoneRegex.test(phone)) { addError("#Phone", "Valid phone is required"); valid = false; }
    if (city === "") { addError("#City", "City is required"); valid = false; }
    if (address === "") { addError("#Address", "Address is required"); valid = false; }

    if (cart.length === 0) {
      alert("Your cart is empty. Please add items before placing an order.");
      valid = false;
    }

    if (valid) {
      alert("Order placed successfully!\nTotal after 30% discount: Rs." + discountedTotal.toLocaleString());
      localStorage.removeItem("cartitems");
      window.location.href = "Home.html";
    }
  });

  function addError(selector, message) {
    $(selector).after('<div class="error-msg">' + message + '</div>');
  }

});
</script>

</body>

</html>